<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Advanced JavaScript Patterns - Demo</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #333;
        line-height: 1.6;
        min-height: 100vh;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }

      header {
        text-align: center;
        margin-bottom: 40px;
        padding: 40px 20px;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        backdrop-filter: blur(10px);
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
      }

      .title {
        font-size: 3rem;
        font-weight: 700;
        background: linear-gradient(135deg, #667eea, #764ba2);
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        color: transparent;
        margin-bottom: 10px;
      }

      .subtitle {
        font-size: 1.2rem;
        color: #666;
        font-weight: 400;
      }

      .demo-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
        gap: 30px;
        margin-bottom: 30px;
      }

      .demo-section {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .section-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: #333;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .section-title::before {
        content: '⚡';
        font-size: 1.2em;
      }

      .control-group {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-bottom: 20px;
        align-items: center;
      }

      .btn {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        font-size: 0.9rem;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
      }

      .btn.success {
        background: linear-gradient(135deg, #48bb78, #38a169);
      }

      .btn.warning {
        background: linear-gradient(135deg, #ed8936, #dd6b20);
      }

      .btn.danger {
        background: linear-gradient(135deg, #f56565, #e53e3e);
      }

      input[type='text'],
      input[type='number'],
      select {
        padding: 10px 15px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 0.9rem;
        transition: all 0.3s ease;
        min-width: 120px;
      }

      input[type='text']:focus,
      input[type='number']:focus,
      select:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .output {
        background: #1a202c;
        border-radius: 8px;
        padding: 20px;
        margin-top: 15px;
        font-family: 'Fira Code', Monaco, 'Cascadia Code', monospace;
        font-size: 0.85rem;
        line-height: 1.6;
        min-height: 120px;
        max-height: 300px;
        overflow-y: auto;
        border: 1px solid #2d3748;
      }

      .output-line {
        margin-bottom: 8px;
        color: #e2e8f0;
      }

      .output-line.success {
        color: #68d391;
      }

      .output-line.error {
        color: #fc8181;
      }

      .output-line.warning {
        color: #f6ad55;
      }

      .output-line.info {
        color: #63b3ed;
      }

      .code-block {
        background: #1e1e1e;
        border-radius: 8px;
        padding: 20px;
        margin: 15px 0;
        font-family: 'Fira Code', Monaco, 'Cascadia Code', monospace;
        font-size: 0.9rem;
        line-height: 1.7;
        white-space: pre-wrap;
        overflow-x: auto;
        border: 1px solid #404040;
        color: #e0e0e0;
      }

      /* CodeMirror will handle syntax highlighting */

      .performance-meter {
        background: #2d3748;
        border-radius: 8px;
        padding: 15px;
        margin-top: 10px;
      }

      .meter-bar {
        background: #4a5568;
        height: 8px;
        border-radius: 4px;
        overflow: hidden;
        margin: 8px 0;
      }

      .meter-fill {
        height: 100%;
        background: linear-gradient(90deg, #48bb78, #38a169);
        transition: width 0.3s ease;
        border-radius: 4px;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin: 15px 0;
      }

      .stat-card {
        background: rgba(255, 255, 255, 0.1);
        padding: 15px;
        border-radius: 8px;
        text-align: center;
      }

      .stat-value {
        font-size: 1.5rem;
        font-weight: bold;
        color: #68d391;
      }

      .stat-label {
        font-size: 0.8rem;
        color: #a0aec0;
        margin-top: 5px;
      }

      .pattern-showcase {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin: 20px 0;
      }

      .pattern-card {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
        padding: 20px;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .pattern-title {
        font-weight: 600;
        color: #63b3ed;
        margin-bottom: 10px;
        font-size: 1.1rem;
      }

      .pattern-description {
        color: #a0aec0;
        font-size: 0.9rem;
        margin-bottom: 15px;
      }

      .tips-section {
        background: linear-gradient(135deg, #1a202c, #2d3748);
        color: white;
        padding: 30px;
        border-radius: 15px;
        margin-top: 30px;
      }

      .tips-title {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 20px;
        color: #63b3ed;
      }

      .tips-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
      }

      .tip-item {
        background: rgba(255, 255, 255, 0.05);
        padding: 15px;
        border-radius: 8px;
        border-left: 4px solid #63b3ed;
      }

      @media (max-width: 768px) {
        .title {
          font-size: 2rem;
        }

        .demo-grid {
          grid-template-columns: 1fr;
        }

        .control-group {
          flex-direction: column;
          align-items: stretch;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1 class="title">Advanced JavaScript Patterns</h1>
        <p class="subtitle">
          Explore modern JavaScript patterns, design principles, and advanced
          techniques
        </p>
      </header>

      <div class="demo-grid">
        <!-- Functional Programming Patterns -->
        <div class="demo-section">
          <h2 class="section-title">Functional Programming</h2>

          <div class="code-block" data-lang="js">
            <span class="js-comment">// Higher-order functions and currying</span>
            <span class="js-keyword">const</span> <span class="js-method">curry</span> = (<span class="js-param">fn</span>) <span class="js-operator">=></span> 
              (<span class="js-param">...args</span>) <span class="js-operator">=></span> 
                args.length >= fn.length 
                  ? fn(...args) 
                  : curry(fn.bind(<span class="js-keyword">null</span>, ...args));

            <span class="js-keyword">const</span> <span class="js-method">multiply</span> = (<span class="js-param">a</span>, <span class="js-param">b</span>) <span class="js-operator">=></span> a * b;
            <span class="js-keyword">const</span> <span class="js-method">curriedMultiply</span> = curry(multiply);

            <span class="js-comment">// Composition and pipe functions</span>
            <span class="js-keyword">const</span> <span class="js-method">compose</span> = (<span class="js-param">...fns</span>) <span class="js-operator">=></span> 
              (<span class="js-param">x</span>) <span class="js-operator">=></span> fns.reduceRight((v, f) => f(v), x);

            <span class="js-keyword">const</span> <span class="js-method">pipe</span> = (<span class="js-param">...fns</span>) <span class="js-operator">=></span> 
              (<span class="js-param">x</span>) <span class="js-operator">=></span> fns.reduce((v, f) => f(v), x);
          </div>

          <div class="control-group">
            <input type="number" id="num1" placeholder="Number 1" value="5" />
            <input type="number" id="num2" placeholder="Number 2" value="3" />
            <button class="btn" onclick="demonstrateFunctional()">
              🔧 Run Functions
            </button>
            <button class="btn warning" onclick="clearOutput('functional-output')">
              Clear
            </button>
          </div>

          <div class="output" id="functional-output"></div>
        </div>

        <!-- Design Patterns -->
        <div class="demo-section">
          <h2 class="section-title">Design Patterns</h2>

          <div class="code-block" data-lang="js">
            <span class="js-comment">// Observer Pattern Implementation</span>
            <span class="js-keyword">class</span> <span class="js-method">Observable</span> {
              <span class="js-method">constructor</span>() {
                <span class="js-keyword">this</span>.observers = [];
              }

              <span class="js-method">subscribe</span>(<span class="js-param">callback</span>) {
                <span class="js-keyword">this</span>.observers.push(callback);
                <span class="js-keyword">return</span> () <span class="js-operator">=></span> {
                  <span class="js-keyword">this</span>.observers = <span class="js-keyword">this</span>.observers.filter(obs => obs !== callback);
                };
              }

              <span class="js-method">notify</span>(<span class="js-param">data</span>) {
                <span class="js-keyword">this</span>.observers.forEach(callback => callback(data));
              }
            }

            <span class="js-comment">// Singleton Pattern with Proxy</span>
            <span class="js-keyword">const</span> <span class="js-method">Singleton</span> = (<span class="js-keyword">function</span>() {
              <span class="js-keyword">let</span> instance;
              <span class="js-keyword">return</span> <span class="js-keyword">class</span> {
                <span class="js-method">constructor</span>() {
                  <span class="js-keyword">if</span> (instance) <span class="js-keyword">return</span> instance;
                  instance = <span class="js-keyword">this</span>;
                }
              };
            })();
          </div>

          <div class="control-group">
            <input type="text" id="message-input" placeholder="Message to broadcast" value="Hello observers!" />
            <button class="btn" onclick="demonstrateObserver()">
              📡 Notify Observers
            </button>
            <button class="btn success" onclick="demonstrateSingleton()">
              🏗️ Test Singleton
            </button>
          </div>

          <div class="output" id="patterns-output"></div>
        </div>

        <!-- Memory Management -->
        <div class="demo-section">
          <h2 class="section-title">Memory Management</h2>

          <div class="code-block" data-lang="js">
            <span class="js-comment">// WeakMap for private data</span>
            <span class="js-keyword">const</span> privateData = <span class="js-keyword">new</span> <span class="js-method">WeakMap</span>();

            <span class="js-keyword">class</span> <span class="js-method">SecureClass</span> {
              <span class="js-method">constructor</span>(<span class="js-param">secret</span>) {
                privateData.set(<span class="js-keyword">this</span>, { secret, counter: <span class="js-number">0</span> });
              }

              <span class="js-method">getSecret</span>() {
                <span class="js-keyword">const</span> data = privateData.get(<span class="js-keyword">this</span>);
                data.counter++;
                <span class="js-keyword">return</span> `Secret accessed ${data.counter} times: ${data.secret}`;
              }
            }

            <span class="js-comment">// Memory leak demonstration</span>
            <span class="js-keyword">function</span> <span class="js-method">createMemoryLeak</span>() {
              <span class="js-keyword">const</span> largeArray = <span class="js-keyword">new</span> <span class="js-method">Array</span>(<span class="js-number">1000000</span>).fill(<span class="js-string">'memory'</span>);
              <span class="js-keyword">return</span> () <span class="js-operator">=></span> largeArray.length;
            }
          </div>

          <div class="control-group">
            <button class="btn" onclick="demonstrateWeakMap()">
              🔒 WeakMap Demo
            </button>
            <button class="btn warning" onclick="simulateMemoryUsage()">
              📊 Memory Check
            </button>
            <button class="btn danger" onclick="triggerGC()">
              🗑️ Force GC
            </button>
          </div>

          <div class="performance-meter">
            <div class="stat-label">Memory Usage Simulation</div>
            <div class="meter-bar">
              <div class="meter-fill" id="memory-meter"></div>
            </div>
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-value" id="heap-used">0</div>
                <div class="stat-label">Heap Used (MB)</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="objects-created">0</div>
                <div class="stat-label">Objects Created</div>
              </div>
            </div>
          </div>

          <div class="output" id="memory-output"></div>
        </div>

        <!-- Advanced Async Patterns -->
        <div class="demo-section">
          <h2 class="section-title">Advanced Async Patterns</h2>

          <div class="code-block" data-lang="js">
            <span class="js-comment">// Async Iterator and Generator</span>
            <span class="js-keyword">async function*</span> <span class="js-method">asyncGenerator</span>(<span class="js-param">max</span>) {
              <span class="js-keyword">for</span> (<span class="js-keyword">let</span> i = <span class="js-number">0</span>; i < max; i++) {
                <span class="js-keyword">await</span> <span class="js-keyword">new</span> <span class="js-method">Promise</span>(<span class="js-param">resolve</span> <span class="js-operator">=></span> setTimeout(resolve, <span class="js-number">100</span>));
                <span class="js-keyword">yield</span> `Item ${i + <span class="js-number">1</span>}`;
              }
            }

            <span class="js-comment">// Debounce and throttle utilities</span>
            <span class="js-keyword">const</span> <span class="js-method">debounce</span> = (<span class="js-param">fn</span>, <span class="js-param">delay</span>) <span class="js-operator">=></span> {
              <span class="js-keyword">let</span> timeoutId;
              <span class="js-keyword">return</span> (<span class="js-param">...args</span>) <span class="js-operator">=></span> {
                clearTimeout(timeoutId);
                timeoutId = setTimeout(() <span class="js-operator">=></span> fn(...args), delay);
              };
            };

            <span class="js-keyword">const</span> <span class="js-method">throttle</span> = (<span class="js-param">fn</span>, <span class="js-param">limit</span>) <span class="js-operator">=></span> {
              <span class="js-keyword">let</span> inThrottle;
              <span class="js-keyword">return</span> (<span class="js-param">...args</span>) <span class="js-operator">=></span> {
                <span class="js-keyword">if</span> (!inThrottle) {
                  fn(...args);
                  inThrottle = <span class="js-keyword">true</span>;
                  setTimeout(() <span class="js-operator">=></span> inThrottle = <span class="js-keyword">false</span>, limit);
                }
              };
            };
          </div>

          <div class="control-group">
            <button class="btn" onclick="demonstrateAsyncIterator()">
              🔄 Async Iterator
            </button>
            <button class="btn success" onclick="demonstrateDebounceThrottle()">
              ⏱️ Debounce/Throttle
            </button>
            <button class="btn warning" onclick="clearOutput('async-output')">
              Clear
            </button>
          </div>

          <div class="output" id="async-output"></div>
        </div>

        <!-- Metaprogramming -->
        <div class="demo-section">
          <h2 class="section-title">Metaprogramming & Proxies</h2>

          <div class="code-block" data-lang="js">
            <span class="js-comment">// Dynamic object with Proxy</span>
            <span class="js-keyword">const</span> <span class="js-method">createSmartObject</span> = (<span class="js-param">data</span> = {}) <span class="js-operator">=></span> {
              <span class="js-keyword">const</span> handlers = {
                <span class="js-method">get</span>(<span class="js-param">target</span>, <span class="js-param">prop</span>) {
                  <span class="js-keyword">if</span> (prop <span class="js-keyword">in</span> target) <span class="js-keyword">return</span> target[prop];
                  <span class="js-keyword">if</span> (<span class="js-keyword">typeof</span> prop === <span class="js-string">'string'</span> && prop.startsWith(<span class="js-string">'get'</span>)) {
                    <span class="js-keyword">const</span> key = prop.slice(<span class="js-number">3</span>).toLowerCase();
                    <span class="js-keyword">return</span> () <span class="js-operator">=></span> target[key];
                  }
                  <span class="js-keyword">return</span> <span class="js-string">`Property ${prop} not found`</span>;
                },
                
                <span class="js-method">set</span>(<span class="js-param">target</span>, <span class="js-param">prop</span>, <span class="js-param">value</span>) {
                  console.log(`Setting ${prop} = ${value}`);
                  target[prop] = value;
                  <span class="js-keyword">return</span> <span class="js-keyword">true</span>;
                }
              };
              
              <span class="js-keyword">return</span> <span class="js-keyword">new</span> <span class="js-method">Proxy</span>(data, handlers);
            };

            <span class="js-comment">// Reflection utilities</span>
            <span class="js-keyword">const</span> <span class="js-method">objectAnalyzer</span> = {
              <span class="js-method">analyze</span>(<span class="js-param">obj</span>) {
                <span class="js-keyword">return</span> {
                  properties: <span class="js-method">Reflect</span>.ownKeys(obj),
                  methods: <span class="js-method">Reflect</span>.ownKeys(obj).filter(key => 
                    <span class="js-keyword">typeof</span> obj[key] === <span class="js-string">'function'</span>
                  ),
                  prototype: <span class="js-method">Reflect</span>.getPrototypeOf(obj)?.constructor?.name
                };
              }
            };
          </div>

          <div class="control-group">
            <input type="text" id="prop-name" placeholder="Property name" value="username" />
            <input type="text" id="prop-value" placeholder="Property value" value="john_doe" />
            <button class="btn" onclick="demonstrateProxy()">
              🎭 Proxy Demo
            </button>
            <button class="btn success" onclick="demonstrateReflection()">
              🔍 Reflection
            </button>
          </div>

          <div class="output" id="meta-output"></div>
        </div>

        <!-- Performance Optimization -->
        <div class="demo-section">
          <h2 class="section-title">Performance Patterns</h2>

          <div class="code-block" data-lang="js">
            <span class="js-comment">// Memoization with Map</span>
            <span class="js-keyword">const</span> <span class="js-method">memoize</span> = (<span class="js-param">fn</span>) <span class="js-operator">=></span> {
              <span class="js-keyword">const</span> cache = <span class="js-keyword">new</span> <span class="js-method">Map</span>();
              <span class="js-keyword">return</span> (<span class="js-param">...args</span>) <span class="js-operator">=></span> {
                <span class="js-keyword">const</span> key = <span class="js-method">JSON</span>.stringify(args);
                <span class="js-keyword">if</span> (cache.has(key)) <span class="js-keyword">return</span> cache.get(key);
                
                <span class="js-keyword">const</span> result = fn(...args);
                cache.set(key, result);
                <span class="js-keyword">return</span> result;
              };
            };

            <span class="js-comment">// Virtual scrolling helper</span>
            <span class="js-keyword">class</span> <span class="js-method">VirtualList</span> {
              <span class="js-method">constructor</span>(<span class="js-param">items</span>, <span class="js-param">itemHeight</span> = <span class="js-number">50</span>, <span class="js-param">visibleCount</span> = <span class="js-number">10</span>) {
                <span class="js-keyword">this</span>.items = items;
                <span class="js-keyword">this</span>.itemHeight = itemHeight;
                <span class="js-keyword">this</span>.visibleCount = visibleCount;
                <span class="js-keyword">this</span>.scrollTop = <span class="js-number">0</span>;
              }

              <span class="js-method">getVisibleItems</span>() {
                <span class="js-keyword">const</span> startIndex = <span class="js-method">Math</span>.floor(<span class="js-keyword">this</span>.scrollTop / <span class="js-keyword">this</span>.itemHeight);
                <span class="js-keyword">const</span> endIndex = startIndex + <span class="js-keyword">this</span>.visibleCount;
                <span class="js-keyword">return</span> <span class="js-keyword">this</span>.items.slice(startIndex, endIndex);
              }
            }
          </div>

          <div class="control-group">
            <input type="number" id="fib-number" placeholder="Fibonacci number" value="35" min="1" max="45" />
            <button class="btn" onclick="demonstratePerformance()">
              ⚡ Performance Test
            </button>
            <button class="btn success" onclick="demonstrateVirtualList()">
              📜 Virtual List
            </button>
          </div>

          <div class="performance-meter">
            <div class="stat-label">Execution Time Comparison</div>
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-value" id="normal-time">0ms</div>
                <div class="stat-label">Normal Fibonacci</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="memoized-time">0ms</div>
                <div class="stat-label">Memoized Fibonacci</div>
              </div>
            </div>
          </div>

          <div class="output" id="performance-output"></div>
        </div>
      </div>

      <!-- Tips Section -->
      <div class="tips-section">
        <h2 class="tips-title">🎯 Advanced JavaScript Best Practices</h2>
        <div class="tips-grid">
          <div class="tip-item">
            <strong>Functional Programming:</strong> Embrace immutability and
            pure functions for predictable code
          </div>
          <div class="tip-item">
            <strong>Memory Management:</strong> Use WeakMap for private data and
            avoid memory leaks
          </div>
          <div class="tip-item">
            <strong>Performance:</strong> Implement memoization for expensive
            calculations
          </div>
          <div class="tip-item">
            <strong>Async Patterns:</strong> Master generators and async
            iterators for complex workflows
          </div>
          <div class="tip-item">
            <strong>Metaprogramming:</strong> Use Proxies for dynamic behavior
            and API creation
          </div>
          <div class="tip-item">
            <strong>Design Patterns:</strong> Choose the right pattern for your
            specific use case
          </div>
        </div>
      </div>
    </div>

    <!-- CodeMirror Integration for proper code display -->
    <script src="../codemirror-integration.js"></script>

    <script>
      // CodeMirror will handle code formatting automatically

      // Global state for demonstrations
      let memoryUsageSimulated = 0;
      let objectsCreated = 0;
      let observable = null;
      let debounceCounter = 0;
      let throttleCounter = 0;

      // Initialize Observable
      document.addEventListener('DOMContentLoaded', function() {
        console.log('⚡ Advanced JavaScript Patterns Demo loaded!');
        
        // Create observable instance
        class Observable {
          constructor() {
            this.observers = [];
          }

          subscribe(callback) {
            this.observers.push(callback);
            return () => {
              this.observers = this.observers.filter(obs => obs !== callback);
            };
          }

          notify(data) {
            this.observers.forEach(callback => callback(data));
          }
        }

        observable = new Observable();
        
        // Subscribe some demo observers
        observable.subscribe(data => {
          appendOutput('patterns-output', `Observer 1 received: ${data}`, 'success');
        });
        
        observable.subscribe(data => {
          appendOutput('patterns-output', `Observer 2 received: ${data}`, 'info');
        });
      });

      // Functional Programming Demo
      function demonstrateFunctional() {
        clearOutput('functional-output');
        
        const num1 = parseInt(document.getElementById('num1').value) || 0;
        const num2 = parseInt(document.getElementById('num2').value) || 0;
        
        // Curry demonstration
        const curry = (fn) => (...args) => 
          args.length >= fn.length ? fn(...args) : curry(fn.bind(null, ...args));
        
        const multiply = (a, b) => a * b;
        const curriedMultiply = curry(multiply);
        
        appendOutput('functional-output', '🔧 Currying Demo:', 'info');
        appendOutput('functional-output', `multiply(${num1}, ${num2}) = ${multiply(num1, num2)}`);
        appendOutput('functional-output', `curriedMultiply(${num1})(${num2}) = ${curriedMultiply(num1)(num2)}`);
        
        // Composition demonstration
        const compose = (...fns) => (x) => fns.reduceRight((v, f) => f(v), x);
        const pipe = (...fns) => (x) => fns.reduce((v, f) => f(v), x);
        
        const addTwo = x => x + 2;
        const multiplyByThree = x => x * 3;
        const square = x => x * x;
        
        const composed = compose(square, multiplyByThree, addTwo);
        const piped = pipe(addTwo, multiplyByThree, square);
        
        appendOutput('functional-output', '\n🔄 Function Composition:', 'info');
        appendOutput('functional-output', `Input: ${num1}`);
        appendOutput('functional-output', `Composed (square ∘ *3 ∘ +2): ${composed(num1)}`);
        appendOutput('functional-output', `Piped (+2 → *3 → square): ${piped(num1)}`);
      }

      // Observer Pattern Demo
      function demonstrateObserver() {
        const message = document.getElementById('message-input').value || 'Default message';
        
        appendOutput('patterns-output', `📡 Broadcasting: "${message}"`, 'warning');
        observable.notify(message);
      }

      // Singleton Pattern Demo
      function demonstrateSingleton() {
        clearOutput('patterns-output');
        
        const Singleton = (function() {
          let instance;
          return class {
            constructor() {
              if (instance) return instance;
              instance = this;
              this.id = Math.random().toString(36).substr(2, 9);
            }
          };
        })();
        
        const instance1 = new Singleton();
        const instance2 = new Singleton();
        
        appendOutput('patterns-output', '🏗️ Singleton Pattern Test:', 'info');
        appendOutput('patterns-output', `Instance 1 ID: ${instance1.id}`);
        appendOutput('patterns-output', `Instance 2 ID: ${instance2.id}`);
        appendOutput('patterns-output', `Are they the same? ${instance1 === instance2 ? 'Yes ✅' : 'No ❌'}`, 'success');
      }

      // WeakMap Demo
      function demonstrateWeakMap() {
        clearOutput('memory-output');
        
        const privateData = new WeakMap();
        
        class SecureClass {
          constructor(secret) {
            privateData.set(this, { secret, counter: 0 });
          }
          
          getSecret() {
            const data = privateData.get(this);
            data.counter++;
            return `Secret accessed ${data.counter} times: ${data.secret}`;
          }
        }
        
        const secure1 = new SecureClass('top-secret-1');
        const secure2 = new SecureClass('confidential-2');
        
        appendOutput('memory-output', '🔒 WeakMap Private Data Demo:', 'info');
        appendOutput('memory-output', secure1.getSecret());
        appendOutput('memory-output', secure1.getSecret());
        appendOutput('memory-output', secure2.getSecret());
        
        // Try to access private data directly (should fail)
        try {
          appendOutput('memory-output', `Direct access attempt: ${secure1.secret}`, 'error');
        } catch (e) {
          appendOutput('memory-output', 'Direct access failed (as expected) ✅', 'success');
        }
      }

      // Memory Usage Simulation
      function simulateMemoryUsage() {
        memoryUsageSimulated = Math.min(memoryUsageSimulated + 20, 100);
        objectsCreated += Math.floor(Math.random() * 1000) + 500;
        
        updateMemoryDisplay();
        
        appendOutput('memory-output', `📊 Memory usage increased to ${memoryUsageSimulated}%`, 'warning');
        appendOutput('memory-output', `Created ${objectsCreated} objects total`);
      }

      // Trigger Garbage Collection (simulated)
      function triggerGC() {
        memoryUsageSimulated = Math.max(memoryUsageSimulated - 30, 0);
        
        updateMemoryDisplay();
        
        appendOutput('memory-output', '🗑️ Garbage collection triggered', 'success');
        appendOutput('memory-output', `Memory usage reduced to ${memoryUsageSimulated}%`);
      }

      function updateMemoryDisplay() {
        document.getElementById('memory-meter').style.width = `${memoryUsageSimulated}%`;
        document.getElementById('heap-used').textContent = Math.round(memoryUsageSimulated * 1.28);
        document.getElementById('objects-created').textContent = objectsCreated.toLocaleString();
      }

      // Async Iterator Demo
      async function demonstrateAsyncIterator() {
        clearOutput('async-output');
        
        appendOutput('async-output', '🔄 Starting async iterator demo...', 'info');
        
        async function* asyncGenerator(max) {
          for (let i = 0; i < max; i++) {
            await new Promise(resolve => setTimeout(resolve, 200));
            yield `Item ${i + 1}`;
          }
        }
        
        const generator = asyncGenerator(3);
        
        for await (const item of generator) {
          appendOutput('async-output', `Generated: ${item}`, 'success');
        }
        
        appendOutput('async-output', 'Async iteration complete! ✅', 'info');
      }

      // Debounce/Throttle Demo
      function demonstrateDebounceThrottle() {
        clearOutput('async-output');
        
        const debounce = (fn, delay) => {
          let timeoutId;
          return (...args) => {
            clearTimeout(timeoutId);
            timeoutId = setTimeout(() => fn(...args), delay);
          };
        };
        
        const throttle = (fn, limit) => {
          let inThrottle;
          return (...args) => {
            if (!inThrottle) {
              fn(...args);
              inThrottle = true;
              setTimeout(() => inThrottle = false, limit);
            }
          };
        };
        
        const normalFunction = () => {
          appendOutput('async-output', `Normal call: ${++debounceCounter}`, 'warning');
        };
        
        const debouncedFunction = debounce(() => {
          appendOutput('async-output', `Debounced call executed after delay`, 'success');
        }, 500);
        
        const throttledFunction = throttle(() => {
          appendOutput('async-output', `Throttled call: ${++throttleCounter}`, 'info');
        }, 300);
        
        appendOutput('async-output', '⏱️ Testing debounce and throttle...', 'info');
        
        // Simulate rapid calls
        for (let i = 0; i < 5; i++) {
          setTimeout(() => {
            normalFunction();
            debouncedFunction();
            throttledFunction();
          }, i * 100);
        }
        
        setTimeout(() => {
          appendOutput('async-output', 'Notice: Debounce executed once, throttle limited calls', 'info');
        }, 1000);
      }

      // Proxy Demo
      function demonstrateProxy() {
        clearOutput('meta-output');
        
        const propName = document.getElementById('prop-name').value || 'username';
        const propValue = document.getElementById('prop-value').value || 'john_doe';
        
        const createSmartObject = (data = {}) => {
          const handlers = {
            get(target, prop) {
              if (prop in target) return target[prop];
              if (typeof prop === 'string' && prop.startsWith('get')) {
                const key = prop.slice(3).toLowerCase();
                return () => target[key];
              }
              return `Property ${prop} not found`;
            },
            
            set(target, prop, value) {
              appendOutput('meta-output', `Setting ${prop} = ${value}`, 'info');
              target[prop] = value;
              return true;
            }
          };
          
          return new Proxy(data, handlers);
        };
        
        const smartObj = createSmartObject();
        
        appendOutput('meta-output', '🎭 Proxy Demo:', 'info');
        smartObj[propName] = propValue;
        
        appendOutput('meta-output', `Direct access: ${smartObj[propName]}`, 'success');
        
        // Try dynamic getter
        const getterName = `get${propName.charAt(0).toUpperCase() + propName.slice(1)}`;
        if (typeof smartObj[getterName] === 'function') {
          appendOutput('meta-output', `Dynamic getter: ${smartObj[getterName]()}`, 'success');
        }
        
        // Try non-existent property
        appendOutput('meta-output', `Non-existent: ${smartObj.nonExistent}`, 'warning');
      }

      // Reflection Demo
      function demonstrateReflection() {
        const objectAnalyzer = {
          analyze(obj) {
            return {
              properties: Reflect.ownKeys(obj),
              methods: Reflect.ownKeys(obj).filter(key => 
                typeof obj[key] === 'function'
              ),
              prototype: Reflect.getPrototypeOf(obj)?.constructor?.name
            };
          }
        };
        
        const testObject = {
          name: 'Test Object',
          value: 42,
          getName() { return this.name; },
          getValue() { return this.value; }
        };
        
        const analysis = objectAnalyzer.analyze(testObject);
        
        appendOutput('meta-output', '🔍 Object Analysis:', 'info');
        appendOutput('meta-output', `Properties: ${analysis.properties.join(', ')}`);
        appendOutput('meta-output', `Methods: ${analysis.methods.join(', ')}`, 'success');
        appendOutput('meta-output', `Prototype: ${analysis.prototype}`);
      }

      // Performance Demo
      function demonstratePerformance() {
        clearOutput('performance-output');
        
        const fibNumber = parseInt(document.getElementById('fib-number').value) || 35;
        
        // Normal Fibonacci (inefficient)
        function fibonacci(n) {
          if (n <= 1) return n;
          return fibonacci(n - 1) + fibonacci(n - 2);
        }
        
        // Memoized Fibonacci
        const memoize = (fn) => {
          const cache = new Map();
          return (...args) => {
            const key = JSON.stringify(args);
            if (cache.has(key)) return cache.get(key);
            
            const result = fn(...args);
            cache.set(key, result);
            return result;
          };
        };
        
        const memoizedFib = memoize(fibonacci);
        
        appendOutput('performance-output', `⚡ Performance test with fibonacci(${fibNumber}):`, 'info');
        
        // Test normal version
        const start1 = performance.now();
        const result1 = fibonacci(fibNumber);
        const time1 = performance.now() - start1;
        
        // Test memoized version
        const start2 = performance.now();
        const result2 = memoizedFib(fibNumber);
        const time2 = performance.now() - start2;
        
        appendOutput('performance-output', `Normal: ${result1} (${time1.toFixed(2)}ms)`, 'warning');
        appendOutput('performance-output', `Memoized: ${result2} (${time2.toFixed(2)}ms)`, 'success');
        
        const speedup = time1 / time2;
        appendOutput('performance-output', `Speedup: ${speedup.toFixed(1)}x faster! 🚀`, 'info');
        
        document.getElementById('normal-time').textContent = `${time1.toFixed(2)}ms`;
        document.getElementById('memoized-time').textContent = `${time2.toFixed(2)}ms`;
      }

      // Virtual List Demo
      function demonstrateVirtualList() {
        class VirtualList {
          constructor(items, itemHeight = 50, visibleCount = 10) {
            this.items = items;
            this.itemHeight = itemHeight;
            this.visibleCount = visibleCount;
            this.scrollTop = 0;
          }

          getVisibleItems(scrollTop = 0) {
            this.scrollTop = scrollTop;
            const startIndex = Math.floor(this.scrollTop / this.itemHeight);
            const endIndex = Math.min(startIndex + this.visibleCount, this.items.length);
            return {
              startIndex,
              endIndex,
              items: this.items.slice(startIndex, endIndex)
            };
          }
        }
        
        // Create a large dataset
        const largeDataset = Array.from({ length: 10000 }, (_, i) => `Item ${i + 1}`);
        const virtualList = new VirtualList(largeDataset, 30, 5);
        
        appendOutput('performance-output', '📜 Virtual List Demo:', 'info');
        appendOutput('performance-output', `Total items: ${largeDataset.length.toLocaleString()}`);
        
        // Simulate scrolling
        const scrollPositions = [0, 500, 1500, 3000];
        
        scrollPositions.forEach((scroll, index) => {
          const visible = virtualList.getVisibleItems(scroll);
          setTimeout(() => {
            appendOutput('performance-output', 
              `Scroll ${scroll}px - Showing items ${visible.startIndex}-${visible.endIndex}: [${visible.items.slice(0, 3).join(', ')}...]`, 
              'success'
            );
          }, index * 300);
        });
      }

      // Utility functions
      function appendOutput(elementId, message, type = 'default') {
        const output = document.getElementById(elementId);
        const line = document.createElement('div');
        line.className = `output-line ${type}`;
        line.textContent = message;
        output.appendChild(line);
        output.scrollTop = output.scrollHeight;
      }

      function clearOutput(elementId) {
        document.getElementById(elementId).innerHTML = '';
      }
    </script>
  </body>
</html>